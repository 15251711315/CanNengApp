(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/report/report"],{"081c":function(e,t,n){"use strict";n.r(t);var a=n("6ec3"),i=n.n(a);for(var r in a)"default"!==r&&function(e){n.d(t,e,function(){return a[e]})}(r);t["default"]=i.a},"0e06":function(e,t,n){"use strict";var a,i=function(){var e=this,t=e.$createElement;e._self._c},r=[];n.d(t,"b",function(){return i}),n.d(t,"c",function(){return r}),n.d(t,"a",function(){return a})},"547b":function(e,t,n){"use strict";(function(e){n("986c"),n("921b");a(n("66fd"));var t=a(n("8adb"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},"6ec3":function(module,exports,__webpack_require__){"use strict";(function(uni,__f__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var uniCalendar=function(){return Promise.all([__webpack_require__.e("common/vendor"),__webpack_require__.e("components/uni-calendar/uni-calendar")]).then(__webpack_require__.bind(null,"3785"))},_default={data:function(){return{tabNum:1,steadyDateChoose:0,transientDateChoose:0,userInfo:{},steadyDate:"周报",steadyPage:1,steadyLine:{lineName:"请选择"},transientPage:1,transientDate:"月报",steadyList:[],transientList:[],transientLine:{lineName:"请选择"},types:["年报","季报"],typesIndex:0,years:[2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],yearsIndex:9,yearsAndQuarter:[[2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],["第一季度","第二季度","第三季度","第四季度"]],yearsAndQuarterIndex1:9,yearsAndQuarterIndex2:0,scrollHeight:"",swiperHeight:"",loadingFlag:!1,disabledFlag:!1,current:0,scrollFlag:!0,lineInfo:{lineName:"暂无默认监测点，请选择",lineIndex:""},startDate:"",endDate:"",startDateMills:"",endDateMills:"",startDate2:"",endDate2:"",startDateMills2:"",endDateMills2:""}},methods:{scrollH:function(){var e=this,t=uni.getSystemInfoSync(),n=t.windowWidth,a=750/n,i=t.windowHeight,r=t.statusBarHeight;e.scrollHeight=parseInt((i-r)*a-274)+"rpx",e.swiperHeight=parseInt((i-r)*a-172)+"rpx"},setScrollFlag:function(){var e=this;e.scrollFlag=!1,setTimeout(function(){e.scrollFlag=!0},30)},changeTab:function(e){this.tabNum=e,this.current=e-1},changeTabBySwiper:function(e){this.tabNum=e.detail.current+1,this.current=e.detail.current},steadyChangeDate:function(e){this.steadyDate=e,this.steadyChooseDate(0),"申请"!=e&&(this.steadyPage=1,this.steadyList=[],this.querySteadyList())},transientChangeDate:function(e){this.transientDate=e,this.transientChooseDate(0),this.transientPage=1,this.transientList=[],this.queryTransientList()},querySteadyList:function querySteadyList(){var that=this;if(that.judgeLogin()){var reportType="";"周报"==that.steadyDate?reportType=1:"月报"==that.steadyDate&&(reportType=2),uni.request({url:that.serverUrl+"/report/reportList",method:"POST",data:{userId:uni.getStorageSync("userInfo").userId,systemType:2,reportType:reportType,page:that.steadyPage++,num:20,lineIndex:that.lineInfo.lineIndex,startTime:that.startDateMills,endTime:that.endDateMills},header:{"content-type":"application/x-www-form-urlencoded"},sslVerify:!1,success:function success(res){if(uni.hideLoading(),"10000"==res.data.resultCode){var list=that.addDateString(eval(res.data.data));null!=list&&void 0!=list&&""!=list&&list!=[]&&(that.steadyList=that.steadyList.concat(list))}else uni.showModal({title:"提示",content:"查询失败，请重试",confirmText:"重试",success:function(e){e.confirm?that.querySteadyList():e.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:637")}})},fail:function(e){uni.hideLoading(),uni.showModal({title:"提示",content:"网络或服务器异常，请稍后再试",showCancel:!1,success:function(e){e.confirm?__f__("log","用户点击确定"," at pages\\report\\report.vue:651"):e.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:653")}})}})}},queryTransientList:function queryTransientList(){var that=this;if(that.judgeLogin()){var reportType="";"周报"==that.transientDate?reportType=1:"月报"==that.transientDate&&(reportType=2),uni.request({url:that.serverUrl+"/report/reportList",method:"POST",data:{userId:uni.getStorageSync("userInfo").userId,systemType:1,reportType:reportType,page:that.transientPage++,num:20,startTime:that.startDateMills2,endTime:that.endDateMills2},header:{"content-type":"application/x-www-form-urlencoded"},sslVerify:!1,success:function success(res){if(uni.hideLoading(),"10000"==res.data.resultCode){var list=that.addDateString(eval(res.data.data));null!=list&&void 0!=list&&""!=list&&list!=[]&&(that.transientList=that.transientList.concat(list))}else uni.showModal({title:"提示",content:"查询失败，请重试",confirmText:"重试",success:function(e){e.confirm?that.queryTransientList():e.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:702")}})},fail:function(e){uni.hideLoading(),uni.showModal({title:"提示",content:"网络或服务器异常，请稍后再试",showCancel:!1,success:function(e){e.confirm?__f__("log","用户点击确定"," at pages\\report\\report.vue:716"):e.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:718")}})}})}},download:function(e){var t=this;uni.showLoading({title:"正在下载",mask:!0}),uni.downloadFile({url:e,success:function(n){uni.hideLoading(),200===n.statusCode?uni.saveFile({tempFilePath:n.tempFilePath,success:function(e){e.savedFilePath;uni.showModal({title:"下载报告成功",content:"下载成功，是否直接打开",success:function(t){t.confirm?uni.openDocument({filePath:n.tempFilePath}):e.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:751")}})},fail:function(){uni.showModal({title:"提示",content:"下载报告失败，请重试",confirmText:"重试",success:function(n){n.confirm?t.download(e):n.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:765")}})}}):uni.showModal({title:"提示",content:"下载报告失败，请重试",confirmText:"重试",success:function(n){n.confirm?t.download(e):n.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:780")}})},fail:function(){uni.hideLoading(),uni.showModal({title:"提示",content:"下载报告失败，请重试",confirmText:"重试",success:function(n){n.confirm?t.download(e):n.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:796")}})}})},applyReport:function(e){var t=this;if(t.judgeLogin()){t.disabledFlag=!0,t.loadingFlag=!0;var n="",a=0,i=0;if(1==e)n=0;else{if(null==t.steadyLine||void 0==t.steadyLine||null==t.steadyLine.lineIndex||void 0==t.steadyLine.lineIndex||""==t.steadyLine.lineIndex)return uni.showModal({title:"提示",content:"请选择监测点",showCancel:!1}),t.loadingFlag=!1,void(t.disabledFlag=!1);n=t.steadyLine.lineIndex}t.loadingFlag=!1,t.disabledFlag=!1,uni.showLoading({mask:!0}),0==t.typesIndex?(a=0,i=t.years[t.yearsIndex]):(a=t.yearsAndQuarterIndex2+1,i=t.yearsAndQuarter[0][t.yearsAndQuarterIndex1]),uni.request({url:t.serverUrl+"/report/customReport",method:"POST",data:{userId:uni.getStorageSync("userInfo").userId,systemType:e,lineIndex:n,quarter:a,year:i},header:{"content-type":"application/x-www-form-urlencoded"},sslVerify:!1,success:function(n){uni.hideLoading(),"10000"==n.data.resultCode?uni.showModal({title:"提示",content:"申请成功",showCancel:!1}):uni.showModal({title:"提示",content:"申请失败，请重试",confirmText:"重试",success:function(n){n.confirm?t.applyReport(e):n.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:880")}})},fail:function(e){uni.hideLoading(),uni.showModal({title:"提示",content:"网络或服务器异常，请稍后再试",showCancel:!1,success:function(e){e.confirm?__f__("log","用户点击确定"," at pages\\report\\report.vue:894"):e.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:896")}})}})}},queryDefaultLine:function(){var e=this;e.judgeLogin()&&uni.request({url:e.serverUrl+"/realtimeinfo/getLineId",method:"POST",data:{userIndex:uni.getStorageSync("userInfo").userId},header:{"content-type":"application/x-www-form-urlencoded"},sslVerify:!1,success:function(t){if("10000"==t.data.resultCode){var n=t.data.data;n&&(e.lineInfo=n,e.querySteadyList(),e.queryTransientList())}else uni.showModal({title:"提示",content:"查询失败，请重试",confirmText:"重试",success:function(t){t.confirm?e.queryDefaultLine():t.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:934")}})},fail:function(){uni.showModal({title:"提示",content:"网络或服务器异常，请稍后再试",showCancel:!1,success:function(e){e.confirm?__f__("log","用户点击确定"," at pages\\report\\report.vue:947"):e.cancel&&__f__("log","用户点击取消"," at pages\\report\\report.vue:949")}})}})},steadyChooseDate:function(e){this.steadyDateChoose=e},transientChooseDate:function(e){this.transientDateChoose=e},addDateString:function(e){for(var t=this,n=0;n<e.length;n++)e[n].dateString=t.formatTime(e[n].startTime)+"至"+t.formatTime(e[n].endTime);return e},changeType:function(e){this.typesIndex=e.detail.value},changeYear:function(e){this.yearsIndex=e.detail.value},changeYearsAndQuarter:function(e){this.yearsAndQuarterIndex1=e.detail.value[0],this.yearsAndQuarterIndex2=e.detail.value[1]},jumpToMyApply:function(e){uni.navigateTo({url:"../myApply/myApply?systemType="+e})},jumpToChooseLine:function(e){var t=this;uni.navigateTo({url:"../chooseLine/chooseLine"}),uni.$on("lineInfoSelect",function(n){1==e?t.transientLine=n:t.steadyLine=n}),uni.$on("lineInfoQuery",function(n){1==e?t.transientLine=n:t.steadyLine=n})},jumpToConditionSteady:function(){var e=this,t=[];t=0==e.userInfo.roleCode?["周报","月报","申请"]:["周报","月报"],uni.navigateTo({url:"../condition/condition?lineInfo="+JSON.stringify(e.lineInfo)+"&startDate="+e.startDate+"&endDate="+e.endDate+"&startDateMills="+e.startDateMills+"&endDateMills="+e.endDateMills+"&dateTypes="+JSON.stringify(t)+"&chooseDateTypeFlag=1&&chooseDateFlag=1&chooseLineFlag=1"}),uni.$once("doQueryInfo",function(t){"申请"==t.steadyDate?e.steadyDate=t.steadyDate:(e.startDate=t.startDate,e.endDate=t.endDate,e.startDateMills=t.startDateMills,e.endDateMills=t.endDateMills,e.lineInfo=t.lineInfo,e.steadyPage=1,e.steadyList=[],e.steadyDate=t.steadyDate,e.querySteadyList())})},jumpToConditionTransient:function(){var e=this,t=[];t=0==e.userInfo.roleCode?["月报","申请"]:["月报"],uni.navigateTo({url:"../condition/condition?lineInfo="+JSON.stringify(e.lineInfo)+"&startDate="+e.startDate2+"&endDate="+e.endDate2+"&startDateMills="+e.startDateMills2+"&endDateMills="+e.endDateMills2+"&dateTypes="+JSON.stringify(t)+"&chooseDateTypeFlag=1&&chooseDateFlag=1&chooseLineFlag=0"}),uni.$once("doQueryInfo",function(t){"申请"==t.transientDate?e.transientDate=t.transientDate:(e.startDate2=t.startDate,e.endDate2=t.endDate,e.startDateMills2=t.startDateMills,e.endDateMills2=t.endDateMills,e.transientPage=1,e.transientList=[],e.transientDate=t.transientDate,e.queryTransientList())})}},components:{uniCalendar:uniCalendar},onLoad:function(){var e=this;if(e.judgeLogin()){(new Date).getMilliseconds();e.userInfo=uni.getStorageSync("userInfo"),__f__("log",e.userInfo.userId," at pages\\report\\report.vue:1071"),e.scrollH(),e.endDate=e.formatTime(new Date),e.startDate=e.endDate.substring(0,8)+"01",e.startDateMills=Date.parse(e.startDate.replace(/-/g,"/")),e.endDateMills=Date.parse(e.endDate.replace(/-/g,"/"))+86399999,e.endDate2=e.formatTime(new Date),e.startDate2=e.endDate.substring(0,8)+"01",e.startDateMills2=Date.parse(e.startDate.replace(/-/g,"/")),e.endDateMills2=Date.parse(e.endDate.replace(/-/g,"/"))+86399999,e.queryDefaultLine()}},onShow:function(){var e=this;if(e.judgeLogin()){var t=uni.getStorageSync("userInfo");e.userInfo.roleCode!=t.roleCode&&(e.userInfo=t)}}};exports.default=_default}).call(this,__webpack_require__("6e42")["default"],__webpack_require__("0de9")["default"])},"8adb":function(e,t,n){"use strict";n.r(t);var a=n("0e06"),i=n("081c");for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);n("f9d0");var s,o=n("f0c5"),l=Object(o["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],s);t["default"]=l.exports},bd15:function(e,t,n){},f9d0:function(e,t,n){"use strict";var a=n("bd15"),i=n.n(a);i.a}},[["547b","common/runtime","common/vendor"]]]);